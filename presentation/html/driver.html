<!-- presentation/html/driver.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Salamah - Driver</title>

  <!-- Mapbox -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
  <link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js"></script>

  <!-- App Scripts -->
  <script src="/js/messages.js"></script>
  <script src="/socket.io/socket.io.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="/css/styles.css">

  <style>
    .split {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 12px;
      height: calc(100vh - 80px);
    }
    #map { width: 100%; height: 100%; border-radius: 12px; overflow: hidden; }
    .panel { display: flex; flex-direction: column; gap: 10px; }
    .students-list { overflow: auto; }

    /* Modal Styles */
    .modal {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex; justify-content: center; align-items: center;
      z-index: 2000;
    }
    .modal.hidden { display: none; }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 350px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      text-align: center;
    }
    .modal-content h3 { margin-top: 0; }
    .modal-content .close {
      float: right;
      font-size: 20px;
      cursor: pointer;
    }
    #emergencyModal label {
      display: block;
      text-align: left;
      font-weight: bold;
      } 

    #emergencyModal select,
    #emergencyModal textarea {
      width: 100%;
      margin-top: 4px;
    }
    /* Mobile Responsive*/
      @media (max-width: 900px) {
  .split {
    grid-template-columns: 1fr;
    height: auto;
  }

  #map {
    height: 350px;
    margin-top: 14px;
  }

  .panel {
    order: 2;
  }

  .card {
    padding: 12px !important;
  }

  .students-list {
    max-height: 200px;
  }

  .btn {
    width: 100%;
    font-size: 16px;
    padding: 10px;
  }
      }
  </style>
</head>

<body>
  <header class="appbar small">
    <div class="brand-inline">
      <img src="/images/salamah logo.png" alt="logo" style="height:70px; width:auto; margin-right:12px;" />
      <div>
        <h1>Driver</h1>
        <p class="sub">Live Tracking & Route</p>
      </div>
    </div>
    <nav>
      <button class="btn ghost" onclick="Auth.logout()">Logout</button>
    </nav>
  </header>

  <main class="container">
    <section class="split">
      <div class="card panel">
        <h2>Assigned Students</h2>
        <div id="studentsTable" class="students-list"></div>
        
        <h3>Route</h3>
        <button id="drawRoute" class="btn">Show Route</button>
        <button id="flyToMe" class="btn">Show My Location</button>

        <!-- Scan QR Button -->
        <h3>QR Code Scanner</h3>
       <button id="openScanner" class="btn"> Scan QR Code</button>

        <!-- Emergency Section -->
        <h3>Emergency</h3>
        <p>If there is an emergency (accident, breakdown, delay), report it here.</p>
        <button id="sendEmergencyBtn" class="btn btn-danger">ðŸš¨ Send Emergency Notification</button>
      </div>

      <div class="card">
        <div id="map"></div>
      </div>
    </section>
  </main>

  <!-- QR Scanner Modal -->
  <div id="qrScannerModal" class="modal hidden">
    <div class="modal-content">
      <span class="close" id="closeQRScanner">&times;</span>
      <h3>ðŸ“· Scan Student QR Code</h3>
      <div id="reader" style="width:300px; margin:auto; border:2px solid #ccc; border-radius:10px;"></div>
      <p id="scan-result" style="margin-top:10px; font-weight:bold; color:#333;"></p>
    </div>
  </div>

  <!-- Emergency Modal -->
  <div id="emergencyModal" class="modal hidden">
  <div class="modal-content">
    <span class="close" id="closeEmergency">&times;</span>
    <h3>ðŸš¨ Report Emergency</h3>

    <label style="margin-top:10px;">Emergency Type</label>
    <select id="emergencyType" required>
      <option value="" disabled selected>-- Select --</option>
      <option value="accident">Accident</option>
      <option value="breakdown">Breakdown</option>
      <option value="delay">Delay</option>
    </select>

    <label style="margin-top:12px;">Please describe the situation briefly (10â€“200 characters)</label>
    <textarea id="emergencyMessage" rows="4" maxlength="200" style="resize:none;"></textarea>

    <button id="submitEmergency" class="btn btn-danger" style="margin-top:12px;">
      Send Notification
    </button>
  </div>
  </div>

  <div id="alertBox" class="alert-box hidden">
    <div class="alert-content">
      <span id="alertMessage"></span>
      <button onclick="hideAlert()">âœ–</button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="/js/app.js"></script>
  <script src="/js/messages.js"></script>
  <script src="/js/driver.js"></script>
</html>
